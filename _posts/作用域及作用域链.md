---
title: 作用域及作用域链
date: 2016-12-07 18:44:20
categories: JavaScript
---

# 作用域
> 作用域就是变量与函数的可访问范围，即作用域控制着变量与函数的可见性和生命周期。在JavaScript中，变量的作用域有全局作用域和局部作用域两种。

## 全局作用域
> 在代码中任何地方都能访问到的对象拥有全局作用域，一般来说以下几种情形拥有全局作用域：

- 在最外层函数外面定义的变量拥有全局作用域
```js
var a=123;
function fn(){
    console.log(a);//123
}
```

- 所有末声明直接赋值的变量自动声明为拥有全局作用域
```js
function fn(){
    var a=b=2;//相当于var a=2,b=2;
}
fn();
console.log(b);//2
console.log(a);//a is not defined
```

- 所有window对象的属性和方法拥有全局作用域
```js
(function () {
    function fn() {
        console.log(1);
    }
    window.fn=fn;
})();
fn();//1
```

## 局部作用域（私有作用域）
> 和全局作用域相反，局部作用域一般只在固定的代码片段内可访问到，最常见的例如函数内部。

```js
function fn() {
    var a=1;
    console.log(a);
}
fn();//1
console.log(a);//a is not defined
```

## 全局变量和局部变量
> 在全局作用域下声明的变量是全局变量，在私有作用域中声明的变量以及函数的形参都是私有变量

- 函数体外部是不能访问私有变量的
- 在函数体内部是可以访问全局变量的
- 任何全局变量都可以认为是window的一个属性
- 赋值的时候，如果这个变量不存在，那么至少能赋值给全局变量
- 取值如果查找到window还没有就报错

# 作用域链
什么是作用域链？
> 每一段js代码（全局代码或函数）都有一个与之关联的作用域链（scope chain）。

> 这个作用域链是一个对象列表或者链表，这组对象定义了这段代码中“作用域中”的变量。

> 在私有作用域中，代码执行的时候，遇到了一个变量，我们首先需要确定它是否为私有变量，如果为私有变量，那么和外面的任何东西都没有关系，直接使用这个变量的值。如果不是私有的，则往当前作用域的上级作用域进行查找，如果上级作用域也没有，则继续查找，一直找到全局window为止，如果window还没有，那么就报错。报错后，如果没有特殊处理，代码会停止运行。这就是作用域链。

```js
var a=4;
function fn() {
    var a=1;
    var b=2;
    return function () {
        var b=3;
        console.log(a);//1
        console.log(b);//3
    }
}
fn()();
console.log(a);//4
```

**如何查找上级作用域**？
上一级作用域是谁，先看这个函数是在哪里定义的，然后看在定义的位置哪个函数包含着当前函数。那么这个包含它的函数就是上一级作用域。
ps:上级作用域就是谁，和函数在哪执行的没有任何关系

# 栈内存与堆内存
**栈内存**：供代码执行的环境，也叫作用域（分为全局作用域和私有作用域）。基本数据类型的值存储在栈内存。
**堆内存**：用来存储引用数据类型的值，比如对象存储的是属性名和属性值组成的字符串，而函数存储的是代码字符串

# 引用数据类型的赋值过程
- 开辟一个堆内存地址
- 把引用数据类型中的代码当做字符串存入这个地址
- 最后把这个内存地址返回给引用数据类型，并且赋值。

# 函数的执行过程
- 提供一个供代码执行的环境==》私有作用域（栈内存）
- 形参赋值。如果实参是引用数据类型，那么形参和实参共用一个地址。
- 预解释函数体中的代码
- 代码逐行执行

